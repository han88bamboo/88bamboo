{% if template contains 'product' and product.id != blank %}
{% assign front_page = 'product' %}
{% elsif template contains 'cart' %}
{% assign front_page = 'cart' %}
{% else %}
{% assign front_page = template %}
{% endif %}

{% assign proxy_prefix = '/apps/create_discount_code' %}
{% capture b_entry %}{{proxy_prefix}}/{{front_page}}/{{shop.permanent_domain}}{% endcapture %}
{% comment %}
{{ '//ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js' | script_tag }}
'div#shopping-cart',
{% endcomment %}

<script type="text/javascript">

  var mamutaCheckoutButtons = ['[href$=\'checkout\']', 'input[name=\'checkout\']', 'input[name=\'結帳\']', 'input[value=\'Checkout\']', 'button[name=\'checkout\']', 'input[name=\'goto_pp\']', 'button[name=\'goto_pp\']', 'input[name=\'goto_gc\']', 'button[name=\'goto_gc\']', '.additional-checkout-button', '.google-wallet-button-holder', '.amazon-payments-pay-button']
  var mamutaCartFormSelectors = ['div#shopping-cart', 'div.mini-cart', 'div#cartSlideoutWrapper',  'section.atc-banner--container.visible', 'div.cart-mini-sidebar', 'div.jas-mini-cart', 'form[action=\'/cart\']', 'form[action^=\'/cart\']', 'form[action$=\'/cart\']', 'div.cart-tools','table.shop_table', 'form[action^=\'/checkout\']', 'form[action=\'/a/dropicheckout\']',  'div.cart', 'div#cart', 'div#sidebar-cart']
  var mamutaProductInfoSelectors = ["form[action*='/cart/add']", "div.product-info"]
  var mamutaProductInfoPosition = "{{ settings.mamuta_product_box_position | default: after }}"
  var mamutaMiniCarts = ['#dropdown-cart .has-items','section.cart-drawer.active form', 'div.cart-summary-overlay', 'div.cart--minicart', 'div#dropdown-cart', 'div#cartAddItemNotification', 'div.cart__popup_content'];
  var mamutaMiniCartCheckouts = ['[href$=\'checkout\']', 'div.actions:nth-child(2) > button:nth-child(1)'];
  var mamutaAnnounces = ['div.header-bar']
  var mamutaAcc = 3000
  var fetchCartDelay = 1000
  var mamutaGridOnly = false
  var agreeTermsId = ''

  var mamutaTier = {
    proxy_prefix: "{{proxy_prefix}}",
    shop_domain: "{{ shop.permanent_domain }}",
    backend_entry: "{{b_entry}}",
    current_page: "{{front_page}}",
    money_format: "{{ shop.money_format }}",
    shop_currency: "{{ shop.currency }}",
    current_currency: "{{ shop.currency }}",
    current_rate: "-1",
    locale: "{{ shop.locale }}",
    template: "{{ template }}",
    customer: {
      id: 0,
    },
    product: {},
    product_collections: [],
    product_collections_handles: {},
    product_variants: [],
    cart: {
     product_lookup: {},
     variant_lookup: {},
    },
    discounts: [],
  }

  mamutaTier.enabled_currencies = [
    {% for curr in shop.enabled_currencies %}
	  "{{ curr.iso_code }}" ,
    {% endfor %}
  ]

  var mamutaItems_lookup = {
    cart_total: {
      key: 'cart_total',
      id: 'cart_total',
      title: 'Subtotal',
      quantity: 0,
      price: 0,
      amount: 0,
      amount_money: '',
    },
  }

  {% if shop.customer_accounts_enabled %}
    {% if customer %}
      mamutaTier.customer.id = {{ customer.id }}
      mamutaTier.customer.email = "{{- customer.email | replace: '"', '\"' -}}"
      mamutaTier.customer.accepts_marketing = {{ customer.accepts_marketing }}
      mamutaTier.customer.orders_count = {{ customer.orders_count }}
      mamutaTier.customer.total_spent = {{ customer.total_spent }}
      mamutaTier.customer.tags = [
        {% for tag in customer.tags %}
          "{{- tag | replace: '"', '\"' -}}" ,
        {% endfor %}
      ]
      {% assign items = customer.last_order.line_items | map: 'title' %}
      mamutaTier.customer.last_order = {
        name: "{{- customer.last_order.name | replace: '"', '\"' -}}",
        email: "{{- customer.last_order.email | replace: '"', '\"' -}}",
        phone: "{{- customer.last_order.phone | replace: '"', '\"' -}}",
        subtotal_price: {{ customer.last_order.subtotal_price | divided_by: 100 }},
        billing_country: "{{- customer.last_order.billing_address.country_code | replace: '"', '\"' -}}",
        billing_city: "{{- customer.last_order.billing_address.city | replace: '"', '\"' -}}",
        billing_phone: "{{- customer.last_order.billing_address.phone | replace: '"', '\"' -}}",
        billing_name: "{{- customer.last_order.billing_address.name | replace: '"', '\"' -}}",
        shipping_country: "{{- customer.last_order.shipping_address.country_code | replace: '"', '\"' -}}",
        shipping_city: "{{- customer.last_order.shipping_address.city | replace: '"', '\"' -}}",
        shipping_phone: "{{- customer.last_order.shipping_address.phone | replace: '"', '\"' -}}",
        shipping_name: "{{- customer.last_order.shipping_address.name | replace: '"', '\"' -}}",
        items_titles: [
        	{% for title in items %}
        		"{{- title | strip | strip_html | replace: '"', '\"' -}}" ,
      		{% endfor %}
        ]
      }
    {% endif %}
  {% endif %}

  var mamutaItems = []

  {% if front_page == 'product' %}
    mamutaTier.product = {
      id: {{ product.id }},
  	  price: {{ product.price }},
  	  handle: "{{- product.handle -}}",
  	  selected_variant: {{ product.selected_or_first_available_variant.id }},
  	  only_default_variant: {{ product.has_only_default_variant }},
  	  in_cart_quantity: 0,
      in_cart_amount: 0,
      in_cart_variant: 0
    }

    mamutaTier.product_collections = [
      {% for c in product.collections %}
  		  {{ c.id }} ,
  	  {% endfor %}
    ]

    mamutaTier.product_collections_handles = {
      {% for c in product.collections %}
  		  "{{ c.id }}": "{{- c.handle -}}" ,
  	  {% endfor %}
    }

    mamutaTier.product_variants = [
      {% for v in product.variants %}
  	  	  {{ v.id }} ,
  	  {% endfor %}
    ]

    mamutaTier.product_price_lookup = {
      {% for v in product.variants %}
        {{ v.id }}: {{ v.price }},
      {% endfor %}
    }

  {% endif %}

    function mamutaMapItem(item) {
      return {
        id: item.id,
        key: item.key,
        title: item.title,
        handle: item.handle,
        //amount: parseInt(item.line_price) / 100,
        //quantity: item.quantity,
        product_id: item.product_id,
        variant_id: item.variant_id,
        product_title: item.product_title,
        variant_title: item.variant_title,
      }
    }

  {% if cart %}

    {% comment %}json filter adds some info, which is not available as the properties, e.g. token{% endcomment %}
    mamutaTier.cart = {{ cart | json }}
    mamutaItems = mamutaTier.cart.items.map((item) => mamutaMapItem(item))
    mamutaTier.cart.items = []
    mamutaTier.cart.items_lookup = {
        {% for item in cart.items %}
            "{{ item.key }}": {
                 key: "{{ item.key }}",
                 id: {{ item.id }},
                 product_id: {{ item.product_id }},
                 variant_id: {{ item.variant_id }},
                 product_title: "{{ item.product.title | replace: '"', '\"' }}",
                 variant_title: "{{ item.variant.title | replace: '"', '\"' }}",
                 quantity: {{ item.quantity }},
                 amount: {{ item.line_price }},
                 price: {{ item.price }},
                 only_default_variant: {{ item.product.has_only_default_variant }},
            },
        {% endfor %}
    }

    mamutaItems_lookup = {
      {% for item in cart.items %}
        "{{ item.key }}": {
          key: "{{ item.key }}",
          id: {{ item.id }},
          product_title: "{{ item.product.title | replace: '"', '\"' }}",
          variant_title: "{{ item.variant.title | replace: '"', '\"' }}",
          title: "{{ item.title | replace: '"', '\"' }}",
          only_default_variant: {{ item.product.has_only_default_variant }},
          quantity: {{ item.quantity }},
          price: {{ item.price | divided_by: 100 }},
          amount: {{ item.line_price | divided_by: 100 }},
          amount_money: "{{ item.line_price | money | replace: '"', '\"' }}",
        },
      {% endfor %}
      cart_total: {
        key: "cart_total",
        id: "cart_total",
        title: "Subtotal",
        quantity: {{ cart.item_count }},
        price: {{ cart.total_price | divided_by: 100 }},
        amount: {{ cart.total_price | divided_by: 100 }},
        amount_money: "{{ cart.total_price | money }}",
      },
    }

    mamutaTier.cart.product_lookup = {
  	  {% for item in cart.items %}
          "{{ item.product_id }}": {
          key: "{{ item.key }}",
          id: {{ item.id }},
          product_id: {{ item.product_id }},
          variant_id: {{ item.variant_id }},
          product_title: "{{ item.product.title | replace: '"', '\"' }}",
          variant_title: "{{ item.variant.title | replace: '"', '\"' }}",
          quantity: {{ item.quantity }},
          amount: {{ item.line_price }},
          price: {{ item.price }},
          only_default_variant: {{ item.product.has_only_default_variant }},
          collections: [
            {% for c in item.product.collections %}
  		      {{ c.id }} ,
  	        {% endfor %}
           ],
          },
  	  {% endfor %}
    }

    mamutaTier.cart.variant_lookup = {
      {% for item in cart.items %}
         "{{ item.variant_id }}": {
         key: "{{ item.key }}",
         id: {{ item.id }},
         product_id: {{ item.product_id }},
         variant_id: {{ item.variant_id }},
         product_title: "{{ item.product.title | replace: '"', '\"' }}",
         variant_title: "{{ item.variant.title | replace: '"', '\"' }}",
         quantity: {{ item.quantity }},
         amount: {{ item.line_price }},
         price: {{ item.price }},
         only_default_variant: {{ item.product.has_only_default_variant }},
       },
      {% endfor %}
    }
  {% endif %}

  </script>
<script type="text/javascript">
{% comment %}mamuta{% endcomment %}
!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=0)}({0:function(t,e,n){t.exports=n("XRRH")},Wr5T:function(t,e){!function(){"use strict";if("object"==typeof window)if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var t=window.document,e=[],n=null,r=null;i.prototype.THROTTLE_TIMEOUT=100,i.prototype.POLL_INTERVAL=null,i.prototype.USE_MUTATION_OBSERVER=!0,i._setupCrossOriginUpdater=function(){return n||(n=function(t,n){r=t&&n?l(t,n):{top:0,bottom:0,left:0,right:0,width:0,height:0},e.forEach((function(t){t._checkForIntersections()}))}),n},i._resetCrossOriginUpdater=function(){n=null,r=null},i.prototype.observe=function(t){if(!this._observationTargets.some((function(e){return e.element==t}))){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(t.ownerDocument),this._checkForIntersections()}},i.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter((function(e){return e.element!=t})),this._unmonitorIntersections(t.ownerDocument),0==this._observationTargets.length&&this._unregisterInstance()},i.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},i.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},i.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter((function(t,e,n){if("number"!=typeof t||isNaN(t)||t<0||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==n[e-1]}))},i.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map((function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}}));return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},i.prototype._monitorIntersections=function(e){var n=e.defaultView;if(n&&-1==this._monitoringDocuments.indexOf(e)){var r=this._checkForIntersections,o=null,i=null;if(this.POLL_INTERVAL?o=n.setInterval(r,this.POLL_INTERVAL):(a(n,"resize",r,!0),a(e,"scroll",r,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in n&&(i=new n.MutationObserver(r)).observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0})),this._monitoringDocuments.push(e),this._monitoringUnsubscribes.push((function(){var t=e.defaultView;t&&(o&&t.clearInterval(o),u(t,"resize",r,!0)),u(e,"scroll",r,!0),i&&i.disconnect()})),e!=(this.root&&this.root.ownerDocument||t)){var c=p(e);c&&this._monitorIntersections(c.ownerDocument)}}},i.prototype._unmonitorIntersections=function(e){var n=this._monitoringDocuments.indexOf(e);if(-1!=n){var r=this.root&&this.root.ownerDocument||t;if(!this._observationTargets.some((function(t){var n=t.element.ownerDocument;if(n==e)return!0;for(;n&&n!=r;){var o=p(n);if((n=o&&o.ownerDocument)==e)return!0}return!1}))){var o=this._monitoringUnsubscribes[n];if(this._monitoringDocuments.splice(n,1),this._monitoringUnsubscribes.splice(n,1),o(),e!=r){var i=p(e);i&&this._unmonitorIntersections(i.ownerDocument)}}}},i.prototype._unmonitorAllIntersections=function(){var t=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var e=0;e<t.length;e++)t[e]()},i.prototype._checkForIntersections=function(){if(this.root||!n||r){var t=this._rootIsInDom(),e=t?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach((function(r){var i=r.element,a=c(i),u=this._rootContainsTarget(i),s=r.entry,l=t&&u&&this._computeTargetAndRootIntersection(i,a,e),d=r.entry=new o({time:window.performance&&performance.now&&performance.now(),target:i,boundingClientRect:a,rootBounds:n&&!this.root?null:e,intersectionRect:l});s?t&&u?this._hasCrossedThreshold(s,d)&&this._queuedEntries.push(d):s&&s.isIntersecting&&this._queuedEntries.push(d):this._queuedEntries.push(d)}),this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},i.prototype._computeTargetAndRootIntersection=function(e,o,i){if("none"!=window.getComputedStyle(e).display){for(var a,u,s,d,p,f,h,w,v=o,y=m(e),g=!1;!g&&y;){var _=null,b=1==y.nodeType?window.getComputedStyle(y):{};if("none"==b.display)return null;if(y==this.root||9==y.nodeType)if(g=!0,y==this.root||y==t)n&&!this.root?!r||0==r.width&&0==r.height?(y=null,_=null,v=null):_=r:_=i;else{var T=m(y),k=T&&c(T),x=T&&this._computeTargetAndRootIntersection(T,k,i);k&&x?(y=T,_=l(k,x)):(y=null,v=null)}else{var C=y.ownerDocument;y!=C.body&&y!=C.documentElement&&"visible"!=b.overflow&&(_=c(y))}if(_&&(a=_,u=v,s=void 0,d=void 0,p=void 0,f=void 0,h=void 0,w=void 0,s=Math.max(a.top,u.top),d=Math.min(a.bottom,u.bottom),p=Math.max(a.left,u.left),f=Math.min(a.right,u.right),w=d-s,v=(h=f-p)>=0&&w>=0&&{top:s,bottom:d,left:p,right:f,width:h,height:w}||null),!v)break;y=y&&m(y)}return v}},i.prototype._getRootRect=function(){var e;if(this.root)e=c(this.root);else{var n=t.documentElement,r=t.body;e={top:0,left:0,right:n.clientWidth||r.clientWidth,width:n.clientWidth||r.clientWidth,bottom:n.clientHeight||r.clientHeight,height:n.clientHeight||r.clientHeight}}return this._expandRectByRootMargin(e)},i.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map((function(e,n){return"px"==e.unit?e.value:e.value*(n%2?t.width:t.height)/100})),n={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},i.prototype._hasCrossedThreshold=function(t,e){var n=t&&t.isIntersecting?t.intersectionRatio||0:-1,r=e.isIntersecting?e.intersectionRatio||0:-1;if(n!==r)for(var o=0;o<this.thresholds.length;o++){var i=this.thresholds[o];if(i==n||i==r||i<n!=i<r)return!0}},i.prototype._rootIsInDom=function(){return!this.root||d(t,this.root)},i.prototype._rootContainsTarget=function(e){return d(this.root||t,e)&&(!this.root||this.root.ownerDocument==e.ownerDocument)},i.prototype._registerInstance=function(){e.indexOf(this)<0&&e.push(this)},i.prototype._unregisterInstance=function(){var t=e.indexOf(this);-1!=t&&e.splice(t,1)},window.IntersectionObserver=i,window.IntersectionObserverEntry=o}function o(t){this.time=t.time,this.target=t.target,this.rootBounds=s(t.rootBounds),this.boundingClientRect=s(t.boundingClientRect),this.intersectionRect=s(t.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0}),this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,n=e.width*e.height,r=this.intersectionRect,o=r.width*r.height;this.intersectionRatio=n?Number((o/n).toFixed(4)):this.isIntersecting?1:0}function i(t,e){var n,r,o,i=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(i.root&&1!=i.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=(n=this._checkForIntersections.bind(this),r=this.THROTTLE_TIMEOUT,o=null,function(){o||(o=setTimeout((function(){n(),o=null}),r))}),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(i.rootMargin),this.thresholds=this._initThresholds(i.threshold),this.root=i.root||null,this.rootMargin=this._rootMarginValues.map((function(t){return t.value+t.unit})).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}function a(t,e,n,r){"function"==typeof t.addEventListener?t.addEventListener(e,n,r||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,n)}function u(t,e,n,r){"function"==typeof t.removeEventListener?t.removeEventListener(e,n,r||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,n)}function c(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function s(t){return!t||"x"in t?t:{top:t.top,y:t.top,bottom:t.bottom,left:t.left,x:t.left,right:t.right,width:t.width,height:t.height}}function l(t,e){var n=e.top-t.top,r=e.left-t.left;return{top:n,left:r,height:e.height,width:e.width,bottom:n+e.height,right:r+e.width}}function d(t,e){for(var n=e;n;){if(n==t)return!0;n=m(n)}return!1}function m(e){var n=e.parentNode;return 9==e.nodeType&&e!=t?p(e):n&&11==n.nodeType&&n.host?n.host:n&&n.assignedSlot?n.assignedSlot.parentNode:n}function p(t){try{return t.defaultView&&t.defaultView.frameElement||null}catch(t){return null}}}()},XRRH:function(t,e,n){"use strict";n.r(e);var r=function(){},o=function(){},i=function(){},a=function(){},u=function(t){return"function"==typeof t},c=function(t){var e=new RegExp("(\\"+["/",".","*","+","?","|","^","(",")","[","]","{","}","\\","$"].join("|\\")+")","g");return t?t.replace(e,"\\$1"):""};function s(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var l=["en-US","en-IN","de-DE","de-LI","fr-FR"].map((function(t){return new Intl.NumberFormat(t,{minimumFractionDigits:2,maximumFractionDigits:2})}));function d(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r("updateAmountMoney");var a=e+"",u=(a=i?a.replace(",","."):a).indexOf(".");if(-1===u?a+=".00":u===a.length-2&&(a+="0"),null===t)return r(),a;if(i){var c="",s=Math.floor(a);[1e9,1e6,1e3].forEach((function(t){var e=Math.floor(s/t);(e>0||c.length>0)&&(c+=m(c,e)+",",s-=e*t)})),c+=m(c,s)+"."+a.split(".")[1],o("value: ",a+"","template",n,"formatted by template",c),a=c}var l=/\{\{\s*amount\S*[\s\S]*\}\}/i,d=t+"",p=d.replace(l,a);return!i&&d.indexOf("comma")>=0&&(p=p.replace(".",",")),i&&(p=(p=(p=p.replace(".",":")).replace(",",".")).replace(":",","),o("SPECIAL money amount",p)),r(),p}var m=function(t,e){if(t.length>0){var n="000"+e;return n.substr(n.length-3)}return e};var p=n("o0o1"),f=n.n(p);function h(t){i("cleanupPrices");var e=y(t);if(i("Cleanup cartForm",t,e),e){var n=e.querySelector(Z);if(n){n.patchedM=!1,n.removeAttribute($);var r=n.getElementsByClassName(tt)[0],a=n.getElementsByClassName(et)[0];if(i("originalTotal",r),r){var u=r.innerHTML;r.parentNode.removeChild(r),a&&a.parentNode.removeChild(a),n.innerHTML=u}}for(var c=v(t).filter((function(t){var e=t.parentNode;if(!e||!t.mamutaTitle)return!1;var n=!("string"==typeof e.className||e.className instanceof String)||e.className.indexOf("visually-hidden")<0;return"IMG"!==e.tagName&&"NOSCRIPT"!==e.tagName&&n})),s=0;s<c.length;++s)o("Removed from",c[s]),c[s].mamutaTitle=!1,c[s].parentNode.patchedM=!1;var l=e.getElementsByClassName(nt);i("originalLinePrice",l),l&&[].forEach.call(l,(function(t){o("cleaned originalLinePrice el",t),t.parentNode.patchedM=!1,t.removeAttribute("data-key"),t.style.textDecoration="none"}));for(var d=[rt,ot,it],m=0;m<d.length;++m){var p=e.getElementsByClassName(d[m]);o("Markup to remove",d[m],p),p&&w(p)}}else i("cartForm not found")}var w=function(t){for(var e=null;t[0];)(e=t[0].parentNode)&&e.removeChild(t[0])};function v(t){var e=[],n=y(t);return n&&(!function t(e,n){if(e.hasChildNodes())for(var r=e.childNodes,o=0;o<r.length;++o)3===r[o].nodeType?n.push(r[o]):t(r[o],n)}(n,e),e=e.filter((function(t){var e=t.data.replace(/\xA0/gi," ").trim();return e&&e.length>1&&!_(e)}))),e}function y(t){var e,n;i("getVisibleForm");var r=document.getElementsByTagName("BODY")[0].getBoundingClientRect(),a=r.right,u=r.bottom,c=t.length===window.mamutaMiniCarts.length,s=sessionStorage.getItem("checkout_selector");if(c)for(var l=0;l<t.length&&(c=t[l].toLowerCase().trim()===window.mamutaMiniCarts[l].toLowerCase().trim());l++);i("isMinicart",c);for(var d=0;d<t.length;++d){e=document.querySelectorAll(t[d]),o("cartForms",e);for(var m=0;m<e.length;++m)if(e[m].hasChildNodes()){var p=e[m].action?e[m].action:"",f=g(e[m],a,u)&&p.indexOf("update")<0;if(o("VISIBLE is",f,window.mamutaTier.current_page,s),f||"cart"!==window.mamutaTier.current_page||c){if(s&&t[d].indexOf("table#")<0)if(!e[m].querySelector(s))continue;n=e[m];break}}else o("Form without children",e[m]);if(n)break}if(!n){var h,w=/\/cart/i;e=document.querySelectorAll("form");for(var v=0;v<e.length;++v)if(e[v].hasChildNodes()&&g(e[v],a,u)){var y=e[v].action?e[v].action:"";if(null!==(h=w.exec(y))&&y.indexOf("update")<0){n=e[v],i("collectFormTextNodes /cart form found",h);break}}}return i("visibleForm",n),n}var g=function(t,e,n){var r=0!==t.offsetHeight&&"none"!==window.getComputedStyle(t).getPropertyValue("display");if("cart"===window.mamutaTier.current_page&&r){var o=t.getBoundingClientRect();r=o.left<e&&o.top<n}return r};var _=function(t){return!t||0===t.length||null!==t.match(/^\s*$/)};function b(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}var T=function(){var t,e=(t=f.a.mark((function t(){var e,n,r,o=arguments;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=o.length>0&&void 0!==o[0]?o[0]:null,t.prev=1,t.next=4,window.mamutaFetchMock("/cart.js",{method:"GET",headers:{Accept:"application/json; charset=utf-8"},credentials:"include"});case 4:if(!(n=t.sent).ok){t.next=11;break}return t.next=8,n.json();case 8:t.t0=t.sent,t.next=12;break;case 11:t.t0=null;case 12:return r=t.t0,u(e)&&e(r),t.abrupt("return",r);case 17:t.prev=17,t.t1=t.catch(1),a("Shopify getCart fault",t.t1);case 20:return t.abrupt("return",null);case 21:case"end":return t.stop()}}),t,null,[[1,17]])})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){b(i,r,o,a,u,"next",t)}function u(t){b(i,r,o,a,u,"throw",t)}a(void 0)}))});return function(){return e.apply(this,arguments)}}(),k=function(){return window.Shopify&&window.Shopify.theme&&window.Shopify.theme.name?window.Shopify.theme.name.toLowerCase():null},x=function(){return window.Shopify&&window.Shopify.shop?window.Shopify.shop.toLowerCase():null};function C(){var t=I();if(!(t<=0)){var e=window.mamutaTier;if(e&&e.discounts&&e.discounts.length>0){for(var n=0;n<e.discounts.length;n++)if(e.discounts[n].original_amount=e.discounts[n].original_amount/t,e.discounts[n].price=e.discounts[n].price/t,e.discounts[n].bundle_totals)for(var r=0;r<e.discounts[n].bundle_totals.length;r++)e.discounts[n].bundle_totals[r].original_amount=e.discounts[n].bundle_totals[r].original_amount/t,e.discounts[n].bundle_totals[r].price=e.discounts[n].bundle_totals[r].price/t;e.cart.original_total_price=e.cart.original_total_price/t,e.cart.total_price=e.cart.total_price/t,e.cart.items_subtotal_price=e.cart.items_subtotal_price/t}}}var I=function(){if(!window.vesternetSmartyVAT)return-1;var t=parseFloat(window.vesternetSmartyVAT);return isNaN(t)||t<=Number.MIN_VALUE?-1:t};function E(t,e){var n=e+"",r=n.indexOf(".");if(-1===r?n+=".00":r===n.length-2&&(n+="0"),null===t)return n;var o=t+"",i=o.replace(/\{\{\s*amount\S*[\s\S]*\}\}/i,n);return o.indexOf("comma")>=0&&(i=i.replace(".",",")),i}function O(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r("refreshFormData"),S(t);var o=sessionStorage.getItem("checkout_selector");(o&&o.length>0||n)&&ct(window.mamutaTier.proxy_prefix+"/cart/"+window.mamutaTier.shop_domain,e,window.mamutaAnnounces),r()}function S(t){r("updateItemsLookup"),i("cartData",t);var e=t.items,n=I();n=n<=0?1:n,window.mamutaItems=e.map((function(t){return mamutaMapItem(t)})),i("All new items",window.mamutaItems),0===e.length&&(window.mamutaTier.cart.product_lookup={},window.mamutaTier.cart.variant_lookup={},window.mamutaTier.cart.items_lookup={},window.mamutaItems_lookup={cart_total:{key:"cart_total",id:"cart_total",title:"Subtotal",quantity:0,price:0,amount:0,amount_money:""}},window.mamutaItems=[]);for(var o=window.mamutaTier.cart.product_lookup,a=window.mamutaTier.cart.variant_lookup,u=window.mamutaTier.cart.items_lookup,c=function(t){var r=e[t].product_id+"",c=o[r];if(c)c.quantity=e[t].quantity,c.amount=e[t].line_price*n,c.price=e[t].price*n;else{i("Add new product",r);var s=window.mamutaTier.product;s?o[s.id]={key:e[t].key,id:e[t].id,product_id:e[t].product_id,variant_id:e[t].variant_id,product_title:e[t].product_title,variant_title:e[t].variant_title,quantity:e[t].quantity,amount:e[t].line_price*n,price:e[t].price*n,only_default_variant:s.only_default_variant,tags:s.tags,collections:window.mamutaTier.product_collections}:i("NULL product",r)}var l=e[t].variant_id+"",m=a[l];if(m)m.quantity=e[t].quantity,m.amount=e[t].line_price*n,m.price=e[t].price*n;else{i("Add new variant",l);var p=window.mamutaTier.product;p?a[e[t].variant_id]={key:e[t].key,id:e[t].id,product_id:e[t].product_id,variant_id:e[t].variant_id,product_title:e[t].product_title,variant_title:e[t].variant_title,quantity:e[t].quantity,amount:e[t].line_price*n,price:e[t].price*n,only_default_variant:p.only_default_variant,tags:p.tags}:i("NULL product/variant",r)}var f=e[t].key+"",h=u[f];if(h)h.quantity=e[t].quantity,h.amount=e[t].line_price*n,h.price=e[t].price*n;else{i("Add new cartItem",f);var w=window.mamutaTier.product;w?u[e[t].key]={key:e[t].key,id:e[t].id,product_id:e[t].product_id,variant_id:e[t].variant_id,product_title:e[t].product_title,variant_title:e[t].variant_title,quantity:e[t].quantity,amount:e[t].line_price*n,price:e[t].price*n,only_default_variant:w.only_default_variant,tags:w.tags}:i("NULL product/variant",r)}var v=window.mamutaItems.find((function(n){return n.id===e[t].id}));v?(v.amount=parseInt(e[t].line_price)/100*n,v.quantity=e[t].quantity):i("Add new item to the list",e[t].id);var y=window.mamutaItems_lookup[e[t].key];if(y)y.quantity=e[t].quantity,y.price=d(null,parseInt(e[t].price)/100*n,null),y.amount=d(null,parseInt(e[t].line_price)/100*n,null),y.amount_money=d(window.mamutaTier.money_format,y.amount,y.amount_money);else{i("Add new item to the lookup",e[t].key);var g=window.mamutaTier.product,_=d(null,parseInt(e[t].line_price)/100*n,null);y={key:e[t].key,id:e[t].id,product_title:e[t].product_title,variant_title:e[t].variant_title,title:e[t].title,only_default_variant:!g||g.only_default_variant,quantity:e[t].quantity,price:d(null,parseInt(e[t].price)/100*n,null),amount:_,amount_money:d(window.mamutaTier.money_format,_,window.mamutaItems_lookup.cart_total?window.mamutaItems_lookup.cart_total.amount_money:",")},window.mamutaItems_lookup[e[t].key]=y}},s=0;s<e.length;++s)c(s);var l=window.mamutaItems_lookup.cart_total;if(l){i("update total");var m=parseInt(t.total_price)/100*n;l.quantity=t.item_count,l.price=d(null,m,null),l.amount=l.price,l.amount_money=d(window.mamutaTier.money_format,m,l.amount_money)}for(var p in window.mamutaTier.cart.token=t.token,window.mamutaTier.cart.note=t.note,window.mamutaTier.cart.attributes=t.attributes,window.mamutaTier.cart.original_total_price=t.original_total_price*n,window.mamutaTier.cart.total_price=t.total_price*n,window.mamutaTier.cart.total_discount=t.total_discount,window.mamutaTier.cart.total_weight=t.total_weight,window.mamutaTier.cart.item_count=t.item_count,window.mamutaTier.cart.requires_shipping=t.requires_shipping,window.mamutaTier.cart.currency=t.currency,window.mamutaTier.discounts=[],window.mamutaTier.cart.items_subtotal_price=window.mamutaTier.cart.items_subtotal_price*n,o)o.hasOwnProperty(p)&&function(){var t=o[p].product_id;window.mamutaItems.findIndex((function(e){return e.product_id===t}))<0&&(i("Delete product",t),delete o[p])}();for(var f in a)a.hasOwnProperty(f)&&function(){var t=a[f].variant_id;window.mamutaItems.findIndex((function(e){return e.variant_id===t}))<0&&(i("Delete variant",t),delete a[f])}();for(var h in u)u.hasOwnProperty(h)&&function(){var t=u[h].variant_id;window.mamutaItems.findIndex((function(e){return e.variant_id===t}))<0&&(i("Delete variant",t),delete u[h])}();r()}function A(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function P(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){A(i,r,o,a,u,"next",t)}function u(t){A(i,r,o,a,u,"throw",t)}a(void 0)}))}}function L(t){XMLHttpRequest.prototype.open=function(e,n,i,u,c){var s=this;r("XMLHttpRequest.prototype.open"),this.addEventListener("readystatechange",P(f.a.mark((function t(){var i,u;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(4===s.readyState&&200===s.status){t.next=2;break}return t.abrupt("return");case 2:if(r("readystatechange"),o("XMLHttpRequest",e,n,window.mamutaTier.current_page),M(e,n)){t.next=8;break}return o("Request method or endpoint is not supported:",e,n),r(),t.abrupt("return");case 8:if((i=s.getResponseHeader("Content-Type"))&&(i.match(/application\/json/i)||i.match(/text\/javascript/i))){t.next=13;break}return o("Response data format not supported:",i),r(),t.abrupt("return",null);case 13:if(!(n.toLowerCase().indexOf("/cart/add.js")<0)){t.next=19;break}return t.next=16,j(s);case 16:t.t0=t.sent,t.next=22;break;case 19:return t.next=21,T();case 21:t.t0=t.sent;case 22:if((u=t.t0)&&"items"in u){t.next=27;break}return a("Cart data cannot be parsed.",s),r(),t.abrupt("return");case 27:if("GET"!==e.toUpperCase()){t.next=32;break}return t.next=30,N(u,n);case 30:t.next=34;break;case 32:return t.next=34,R(u,n);case 34:r();case 35:case"end":return t.stop()}}),t)}))),!1),o("call original",n),t.call(this,e,n,i,u,c),r()}}var M=function(t,e){var n=t.toLowerCase(),r=new URL(e.toLowerCase(),"https://shouldbevalid.url"),o=r.pathname,i=r.search;return"get"===n?o.indexOf("/cart.js")<0&&o.indexOf("/cart/change.js?")<0:"post"===n&&(i.indexOf("upsellClick")<0&&(o.indexOf("/cart/change.js")>=0||"/cart/update.js"===o||o.indexOf("/cart/add.js")>=0))};function N(t,e){return D.apply(this,arguments)}function D(){return(D=P(f.a.mark((function t(e,n){var a,u,c;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r("completeUpdate"),a=sessionStorage.getItem("cart_update_complete"),u=a?JSON.parse(a):{token:-1,item_count:-1,total_price:-1},c=e.token!==u.token||e.item_count!==u.item_count||e.total_price!==u.total_price,o("True update: ",c),sessionStorage.setItem("cart_update_complete",JSON.stringify({token:e.token,item_count:e.item_count,total_price:e.total_price})),"cart"===window.mamutaTier.current_page?(i("ON CART Complete UPDATE",c),c&&(h(window.mamutaCartFormSelectors),h(window.mamutaAnnounces),setTimeout((function(){r("Update completion refresh setTimeout"),O(e,window.mamutaCartFormSelectors),r()}),500))):(i("ON page Complete UPDATE",window.mamutaTier.current_page,c),n.indexOf("/cart/change.js?")>=0?c&&(i("Schedule reload"),setTimeout((function(){r("Update completion clicker setTimeout"),sessionStorage.setItem("clickme","a[href='/cart'"),r(),location.reload()}),500)):(i("Doing refresh"),O(e,window.mamutaCartFormSelectors))),r();case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function R(t,e){return q.apply(this,arguments)}function q(){return(q=P(f.a.mark((function t(e,n){var o,a,u;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r("updateData"),document.querySelector("input[value='Checkout']"),o=k(),o&&o.indexOf("galleria")>=0,a=x(),a&&(a.indexOf("adelline")>=0||a.indexOf("joel-nolan")>=0||a.indexOf("bloom")>=0),h(window.mamutaCartFormSelectors),h(window.mamutaAnnounces),sessionStorage.setItem("cart_update_complete",JSON.stringify({token:e.token,item_count:e.item_count,total_price:e.total_price})),u=a.indexOf("adogadgets")>=0,setTimeout((function(){r("Update data setTimeout"),"cart"===window.mamutaTier.current_page?u?(i("Doing refresh on cart page"),O(e,window.mamutaCartFormSelectors,!1)):(i("Schedule reload on cart page"),location.reload()):(i("Doing refresh on a page",window.mamutaTier.current_page),O(e,window.mamutaCartFormSelectors,a.indexOf("bloom")>=0)),r()}),300),r();case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var j=function(){var t=P(f.a.mark((function t(e){var n,r,i;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=null,"responseText"in e&&e.responseText&&e.responseText.length>0){o("response as text");try{n=JSON.parse(e.responseText)}catch(t){a("responseText parse fault",t)}}if(n||!(e.response instanceof Blob)){t.next=16;break}if(o("response as blob"),!(r=new Response(e.response)).ok){t.next=16;break}return t.prev=6,t.next=9,r.json();case 9:i=t.sent,n=JSON.parse(i),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(6),a("Blob parse fault",t.t0);case 16:return t.abrupt("return",n);case 17:case"end":return t.stop()}}),t,null,[[6,13]])})));return function(e){return t.apply(this,arguments)}}();function F(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function H(t){if(r("backendDispatch"),"product"!==window.mamutaTier.current_page)return o("not product page"),void r();var e=document.getElementById(z);e&&e.parentNode.removeChild(e);var n=t.data;if(n&&n.content&&n.content.length>0){for(var i=null,a=0;a<mamutaProductInfoSelectors.length;++a){for(var u=document.querySelectorAll(mamutaProductInfoSelectors[a]),c=0;c<u.length;++c)if(u[c].offsetHeight>0&&"none"!==window.getComputedStyle(u[c]).getPropertyValue("display")){i=u[c];break}if(i)break}if(i&&i.parentElement){var s=document.createRange().createContextualFragment(n.content).firstChild;i.parentElement.insertBefore(s,"before"===mamutaProductInfoPosition?i:i.nextSibling)}else o("Cart form not found",i)}r()}function U(t,e,n){if(r("processAnnounceDiscounts"),!e||0===e.length||!n||0===n.length)return o("no discounts",e),void r();var a=n.filter((function(t){return null!==document.querySelector(t)}));if(0===a.length)return o("no active selectors"),void r();var u=e.filter((function(t){return"cart_total"===t.key}))[0];if(0===u.success_note.length)return o("no total discount"),void r();for(var c=t[u.key],s=0;s<a.length;s++){var l=v([a[s]]);if(o("text nodes for ",a[s],l),J(c,l,window.mamutaItems.length,window.mamutaItems_lookup.cart_total.quantity,!1)){i("announce patched for",a[s]);var m=document.querySelector(a[s]);if(null!==m){var p=m.querySelector(".".concat(tt)),f=m.querySelector(".".concat(et)),h=null;p&&(p.style.textDecoration="line-through",h=p.querySelector(".money"));var w=u.amount.replace(/<[^>]+>/g,""),y=x();if(y&&y.indexOf("adelline")>=0&&(w=d(u.money_format,w.replace(/[^\d.,]/g,""),null,!0),o("SPECIAL PATCH",w)),f)if(h&&f.childElementCount<1){var g=document.createElement("span");g.setAttribute("class","money"),g.innerHTML=w,f.appendChild(g)}else f.innerHTML=w}else o("element not found for",a[s])}else o("patchCartTotal fault for",a[s])}r()}function B(t,e,n){if(r("processCartDiscounts"),window.mamutaCartDiscountsProc)return o("processCartDiscounts busy"),void r();if(window.mamutaCartDiscountsProc=!0,!e||0===e.length)return i("no discounts"),r(),void(window.mamutaCartDiscountsProc=!1);try{var u=v(n);if(0===u.length)return o("text nodes not found"),r(),void(window.mamutaCartDiscountsProc=!1);for(var s=window.mamutaItems.length,l=window.mamutaItems_lookup.cart_total.quantity,d=[],m=[],p=0;p<e.length;++p)"cart_total"!==e[p].key?m.push(e[p]):d.push(e[p]);for(var f=x(),h=f&&f.indexOf("adelline")>=0,w=0;w<d.length;++w){var y=d[w];if(y.success_note&&0!==y.success_note.length){var g=t[y.key];o("inCart",g),V(y,g,u,s,l,h)}else i("cart total not successful",y)}for(var _=m.length>0?function(t,e){r("getProductSlices");var n=t.filter((function(t){var e=t.parentNode;if(!e)return!1;var n=!("string"==typeof e.className||e.className instanceof String)||e.className.indexOf("visually-hidden")<0;return"IMG"!==e.tagName&&"NOSCRIPT"!==e.tagName&&"SCRIPT"!==e.tagName&&n}));o("Title candidates",n);for(var i=e.map((function(t){var e=t.title.split(" - ").map((function(t){return t.trim()})).filter((function(t){return t.length>0}));if(0===e.length)return{};for(var r=-1,i=function(t){var i=("("+c(e[t])+")").replace(/\s+/g,"\\s+");o("Title search term",i);var a=new RegExp("(?<!([a-zA-Z0-9]) )"+i+"(?! [a-zA-Z0-9])","i");if((r=n.findIndex((function(t){return a.test(t.data)&&!t.mamutaTitle})))>=0)return n[r].mamutaTitle=!0,o("Title candidate:",a,n[r],r),"break"},a=0;a<e.length;++a){if("break"===i(a))break}return{itemKey:t.key,nodeIdx:r}})).filter((function(t){return t.nodeIdx>=0})),a={},u=0;u<i.length;++u){var s=i[u].nodeIdx,l=u+1>=i.length?n.length:i[u+1].nodeIdx;a[i[u].itemKey]={formRow:n.slice(s,l)}}return r(),a}(u,window.mamutaItems):null,b=0;b<m.length;++b){var T=m[b].key;if(o("patch item:",b,T),T in _){var k=_[T],C=t[T];X(k,m[b],C,h)}else o("NULL slice",_)}}catch(t){a("Exception in processCartDiscounts",t)}finally{r(),window.mamutaCartDiscountsProc=!1}window.mamutaCartDiscountsProc=!1}function V(t,e,n,r,a,u){var c=J(e,n,r,a,!1);if(i("Patch cart_total",c),c){for(var s=null,l=null,m=document.querySelectorAll(".".concat(tt)),p=0;p<m.length;p++)G(m[p])||((l=m[p]).style.textDecoration="line-through",s=l.querySelector(".money"));var f=null,h=document.querySelectorAll(".".concat(et));o("All patched nodes",h);var w=t.amount.replace(/<[^>]+>/g,"");u&&(w=d(t.money_format,w.replace(/[^\d.,]/g,""),null,!0));for(var v=0;v<h.length;v++)if(!G(h[v]))if(f=h[v],s&&f.childElementCount<1){var y=document.createElement("span");y.setAttribute("class","money"),y.innerHTML=w,f.appendChild(y)}else f.innerHTML=w}else o("Patch total complete failure")}var G=function(t){var e=t.parentNode;return e&&e.classList.contains("visually-hidden")||e.parentNode&&e.parentNode.classList.contains("visually-hidden")};function X(t,e,n,a){if(r("processLineItems"),0!==t.formRow.length){i("params",t,e,n,a);var u=t.formRow[0];i("Title Node",u);var c=u?u.parentNode:null;if(i("Title Parent",c),i("Title patched:",c,c.innerHTML,c.patchedM),!c)return o("Title not exists"),void r();if(!(c.patchedM||c.innerHTML.indexOf(ot)>=0||c.innerHTML.indexOf(it)>=0)&&(e.success_note.length>0||e.upsell_note.length>0)){c.patchedM=!0;var s=document.createElement("div");e.success_note.length>0&&(s.setAttribute("class",ot),s.setAttribute("data-key",e.key),s.innerHTML=e.success_note);var l=document.createElement("div");e.upsell_note.length>0&&(l.setAttribute("class",it),l.setAttribute("data-key",e.key),l.style.cursor="pointer",l.style.touchAction="manipulation",l.setAttribute("upsell_quantity",e.upsell_quantity),l.addEventListener("click",Y,!1),l.innerHTML=e.upsell_note);var m=c.nextSibling&&3!==c.nextSibling.nodeType?c.nextSibling:null,p=["A","P","LI"].indexOf(c.tagName)>=0||m?c.parentNode:c;l=e.upsell_note.length>0?p.insertBefore(l,m):null,e.success_note.length>0?(i("insert success node. parent",p),p.insertBefore(s,l||m)):s=null}if(0===e.success_note.length)return i("not success for item",e),void r();var f=K(n.amount_money.replace(/<[^>]+>/g,""),n.amount,t.formRow);f=(f=f.reverse()).filter((function(t,e,n){return 0===e||t.data!==n[e-1].data}));for(var h=0;h<f.length;++h){var w=f[h],v=w.parentNode;if(v&&!v.patchedM&&v.innerHTML.indexOf(nt)<0){v.patchedM=!0;var y=document.createElement("span");y.setAttribute("class",nt),y.setAttribute("data-key",e.key),y.style.textDecoration="line-through";var g=document.createElement("span");g.setAttribute("class",rt),g.style.display="block",v.removeChild(w);var _=v.getAttribute("class"),b=e.amount.replace(/<[^>]+>/g,"");if(a&&(b=d(e.money_format,b.replace(/[^\d.,]/g,""),null,!0)),_&&_.indexOf("money")>=0){var T=document.createElement("span");T.setAttribute("class",_),T.innerHTML=b,g.appendChild(T);var k=document.createElement("span");k.setAttribute("class","money"),k.innerHTML=w.data.replace(/<[^>]+>/g,""),y.appendChild(k),v.removeAttribute("class")}else y.innerHTML=w.data,g.innerHTML=b;var x=v.lastElementChild;x?(v.insertBefore(y,x),v.insertBefore(g,x.nextSibling)):(g=v.appendChild(g),v.insertBefore(y,g))}}r()}}function J(t,e,n,a,u){r("patchCartTotal"),i("cartItem.amount_money",t.amount_money);var c=K(t.amount_money.replace(/<[^>]+>/g,""),t.amount,e);if(o("Amount nodes",c),c.length<1)return o("Amount Not found again ",t.amount),r(),!1;var s=c.length;1===n&&c.length>1&&(s=2===c.length?c[0].data===c[1].data?1:2:c.length<4?1:c.length-2);for(var l=u?0:c.length-s;l<c.length;++l)W(c,l,u,!1);return r(),!0}function K(t,e,n){r("findAmountNodes");var i=t.replace(/\xA0/gi," "),a=i.match(/(\D*)(\S*)(\D*)/i),u=a&&a.length>0&&a[1].length>0?"("+c(a[1])+")?":"",d=a&&a.length>0&&a[3].length>0?"("+c(a[3])+")?":"",m=(e+"").replace(/\xA0/gi," ").trim();o("am prefix suffix",i,u,d);var p=function(t){var e=l.map((function(e){return e.format(t)}));e.push(e[e.length-1].replace(/,/i,"."));var n=e.map((function(t){return t.substring(0,t.length-3)}));return[].concat(s(e),s(n)).filter((function(t,e,n){return n.indexOf(t)===e}))}(m).map((function(t){return"("+u+c(t)+d+")"})).join("|").replace(/\s+/g,"\\s+"),f=new RegExp(p,"gui"),h=n.filter((function(t){var e,n=t.data.replace(/\xA0/gi," ").trim();if(n.length>=100||n.indexOf("button")>=0||n.indexOf("<img")>=0)return o("txt filtered out",n,n.length),!1;for(var r=!1;null!==(e=f.exec(n));)e.index===f.lastIndex&&f.lastIndex++,e.forEach((function(t,e){r||void 0===t||(r=!0)}));return r}));return h=h.filter((function(t){var e=t.parentNode.parentNode;return!(e&&("string"==typeof e.className||e.className instanceof String))||e.className.indexOf("visually-hidden")<0})),o("textElements",n),o("amountExpr",f),o("elements",h),r(),h}function W(t,e,n,a){r("insertTotalPricePatchNodes"),o("num",e);var u=t[e],c=u.parentNode;if(null===c)return o(" totalParent NULL"),void r();if(c.patchedM||c.className.indexOf(tt)>=0||c.innerHTML.indexOf(tt)>=0)return o("total parent patched",c),void r();c.patchedM=!0,c.setAttribute($,Q),F(c.parentElement.children).filter((function(t){return 1===t.nodeType&&t!==c})).map((function(t){t.getAttribute("aria-hidden")&&t.lastChild&&t.lastChild.textContent.trim()===u.textContent.trim()&&(c.classList.remove("visually-hidden"),t.classList.add("visually-hidden"))})),i("totalParent",c,u);var s=c.getAttribute("class"),l=document.createElement("span"),d=document.createElement("span");if(l.setAttribute("class",tt),d.setAttribute("class",et),s&&s.indexOf("money")>=0){var m=document.createElement("span");m.setAttribute("class",s),m.innerHTML=u.data.replace(/<[^>]+>/g,""),m.patchedM=!0,l.appendChild(m),c.removeAttribute("class")}else{var p=document.createTextNode(u.data);l.appendChild(p)}l.patchedM=!0,d.style.display="block";var f=c.lastElementChild;o("last",f),f?(c.insertBefore(l,f),c.insertBefore(d,f.nextSibling),c.removeChild(u),o("Added after last")):(c.replaceChild(l,u),c.insertBefore(d,l.nextSibling),o("Replaced")),r()}function Y(t){r("onUpsellNoteClick");var e=t.currentTarget,n=e.getAttribute("upsell_quantity");if(!n||n<=0)return o("Empty upsell quantity",n),void r();var i=e.getAttribute("data-key");if(!(i=i?i.substring(0,i.indexOf(":")):null)||0===i.length)return o("Empty lineItemId",i),void r();var a=new XMLHttpRequest;a.open("POST","/cart/change.js?upsellClick",!0),a.onreadystatechange=function(){4===a.readyState&&(r("onUpsellNoteClick ready state"),o("On page",window.mamutaTier.current_page),200===a.status&&("cart"!==window.mamutaTier.current_page&&(o("Store selector"),sessionStorage.setItem("clickme","a[href='/cart'")),o("Schedule reload"),location.reload()),r())},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-Type","application/json; charset=utf-8");var u=JSON.stringify({quantity:n,id:i});a.send(u),r()}var z="tiers",$="mamuta_total_parent",Q="mamuta_total_parent",Z="[".concat($,'="').concat(Q,'"]'),tt="tierprice-original-cart-total",et="tierprice-cart-total",nt="tierprice-cart-item-line-price",rt="tierprice-cart-item-line-price-new",ot="tierprice-cart-item-success-notes",it="tierprice-cart-item-upsell-notes";function at(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function ut(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){at(i,r,o,a,u,"next",t)}function u(t){at(i,r,o,a,u,"throw",t)}a(void 0)}))}}function ct(t,e){if(window.mamutaCartDiscountsAPI)o("fetchCartDiscounts API busy");else{window.mamutaCartDiscountsAPI=!0;var n=window.fetchCartDelay?parseInt(window.fetchCartDelay,10):0;isNaN(n)||n<=0?st(t,e,window.mamutaAnnounces).then((function(t){return window.mamutaCartDiscountsAPI=!1})).catch((function(t){return window.mamutaCartDiscountsAPI=!1})):setTimeout((function(){st(t,e,window.mamutaAnnounces).then((function(t){return window.mamutaCartDiscountsAPI=!1})).catch((function(t){return window.mamutaCartDiscountsAPI=!1}))}),n)}}function st(t,e,n){return lt.apply(this,arguments)}function lt(){return(lt=ut(f.a.mark((function t(e,n,o){var u,c,s,l;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r("fetchCartDiscountsAPI"),t.prev=1,_t(),u=JSON.stringify(window.mamutaTier),t.next=6,window.mamutaFetchMock(e,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8","X-Mamuta-Content":window.Shopify.designMode?encodeURIComponent(u):""},credentials:"include",body:u});case 6:if(!(c=t.sent).ok){t.next=13;break}return t.next=10,c.json();case 10:t.t0=t.sent,t.next=14;break;case 13:t.t0=null;case 14:if(null!==(s=t.t0)){t.next=18;break}return r(),t.abrupt("return");case 18:i("Discounts data from backend",s.data),(l=s.data.discounts)&&l.length>0&&(window.mamutaTier.discounts=l,n&&n.length>0&&window.requestAnimationFrame((function(t){return B(window.mamutaItems_lookup,l,n)})),o&&o.length>0&&window.requestAnimationFrame((function(t){return U(window.mamutaItems_lookup,l,o)}))),t.next=26;break;case 23:t.prev=23,t.t1=t.catch(1),a("Exception in fetchCartDiscountsAPI",t.t1);case 26:r();case 27:case"end":return t.stop()}}),t,null,[[1,23]])})))).apply(this,arguments)}function dt(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function mt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){dt(i,r,o,a,u,"next",t)}function u(t){dt(i,r,o,a,u,"throw",t)}a(void 0)}))}}function pt(t){r("fetchProductDiscounts"),window.mamutaProductDiscountsAPI||(function(t){return ft.apply(this,arguments)}(t).then().catch(),r())}function ft(){return(ft=mt(f.a.mark((function t(e){var n,r,o;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return window.mamutaProductDiscountsAPI=!0,t.prev=1,_t(),n=JSON.stringify(window.mamutaTier),t.next=6,window.mamutaFetchMock(e,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8","X-Mamuta-Content":window.Shopify.designMode?encodeURIComponent(n):""},credentials:"include",body:n});case 6:if(!(r=t.sent).ok){t.next=13;break}return t.next=10,r.json();case 10:t.t0=t.sent,t.next=14;break;case 13:t.t0=null;case 14:if(null!==(o=t.t0)){t.next=18;break}return window.mamutaProductDiscountsAPI=!1,t.abrupt("return");case 18:window.requestAnimationFrame((function(t){return H(o)})),t.next=24;break;case 21:t.prev=21,t.t1=t.catch(1),a("Exception in fetchProductDiscountsAPI",t.t1);case 24:window.mamutaProductDiscountsAPI=!1;case 25:case"end":return t.stop()}}),t,null,[[1,21]])})))).apply(this,arguments)}function ht(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function wt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){ht(i,r,o,a,u,"next",t)}function u(t){ht(i,r,o,a,u,"throw",t)}a(void 0)}))}}function vt(t){return yt.apply(this,arguments)}function yt(){return(yt=wt(f.a.mark((function t(e){var n,r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=JSON.stringify(window.mamutaTier),t.next=3,window.mamutaFetchMock(e,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8","X-Mamuta-Content":window.Shopify.designMode?encodeURIComponent(n):""},credentials:"include",body:n});case 3:return r=t.sent,t.abrupt("return",r.json());case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var gt=String.fromCharCode,_t=function(){window.Shopify&&window.Shopify.currency&&(window.mamutaTier.current_currency=window.Shopify.currency.active||window.mamutaTier.current_currency,window.mamutaTier.current_rate=window.Shopify.currency.rate||window.mamutaTier.current_rate)};function bt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Tt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?bt(Object(n),!0).forEach((function(e){kt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function kt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xt(t){var e="string"==typeof t?t.toLowerCase():"";return!window.mamutaGridOnly&&e.indexOf("/wallets/checkouts")>=0}function Ct(t,e,n,u,c){r("interceptCheckoutResponse");var s=!1;mamutaFetchMock.apply(this,t).then((function(t){if("opaque"===t.type)return o("Checkout API: FETCH OPAQUE"),void r();if(i("FETCH RESPONSE",t),e(t),s=t.ok&&xt(t.url)){var n=t.headers.get("Content-Type"),a=n&&n.match(/application\/json/i);return void 0!==u&&a?t.clone().json():void 0}})).then((function(t){if(!s||void 0===t)return o("unacceptable checkout data",t),void r();i("CHECKOUT DATA",t,"AUTH",u,"CODE",c);var e=t.checkout.token;if(!e||void 0===c)return o("token not found or undefined discounts",t),void r();c.then((function(n){if(i("Backend data response",n),!(n&&n.data&&n.data.discount_code&&n.data.discount_code.length>0))return o("no data from the backend",t),void r();var c=JSON.stringify({checkout:{token:e,discount_code:n.data.discount_code}});setTimeout((function(){i("UPDATE CHECKOUT"),mamutaFetchMock("/wallets/checkouts/"+e+".json",{method:"PUT",headers:Tt({"Content-Type":"application/json; charset=utf-8"},u),credentials:"include",body:c}).then((function(t){return o("UPDATED CHECKOUT A"),t.json()})).then((function(t){o("UPDATED CHECKOUT",t)})).catch((function(t){a("ERROR UPDATE CHECKOUT",t)}))}),500)})),i("DONE with data",t)})).catch((function(t){return n(t)})),r()}function It(t){var e="string"==typeof t?t.toLowerCase():"";return e.indexOf("/cart/add")>=0||e.indexOf("/cart/change")>=0}function Et(t,e,n){r("interceptCartAPIResponse");var i=!1,u="";mamutaFetchMock.apply(this,t).then((function(t){if("opaque"===t.type)return o("Cart API: FETCH OPAQUE"),void r();o("FETCH RESPONSE"),e(t),u=t.url.toLowerCase(),i=t.ok&&It(u);var n=t.headers.get("Content-Type"),a=n&&(n.match(/application\/json/i)||n.match(/text\/javascript/i));return i&&a?t.clone().json():null})).then((function(t){t?(u.indexOf("/cart/change")>=0&&Ot(t),u.indexOf("/cart/add")>=0&&St(t)):o("null data in FETCH RESPONSE")})).catch((function(t){a("FAULT in FETCH RESPONSE",t),n(t)})),r()}var Ot=function(t){i("Change cart",t),h(window.mamutaCartFormSelectors),h(window.mamutaAnnounces),setTimeout((function(){O(t,window.mamutaCartFormSelectors)}),500)},St=function(t){i("Add to cart",t);var e=parseInt(t.line_price,10),n=d(null,parseInt(t.price,10)/100,null),r=d(null,e/100,null),o=d(window.mamutaTier.money_format,e/100,null),a=t.product_title?t.product_title.replace('"','\\"'):"",u=t.variant_title?t.variant_title.replace('"','\\"'):"",c=t.title?t.title.replace('"','\\"'):"",s={key:t.key,id:t.id,product_title:a,variant_title:u,title:c,only_default_variant:t.product_has_only_default_variant,quantity:t.quantity,price:t.price,amount:t.line_price,amount_money:o,product_id:t.product_id,variant_id:t.variant_id,collections:window.mamutaTier.product_collections};window.mamutaTier.cart.variant_lookup[t.variant_id]=s,window.mamutaTier.cart.product_lookup[t.product_id]=s,window.mamutaTier.cart.items_lookup[t.key]=s,window.mamutaTier.cart.items=[t],window.mamutaItems=window.mamutaTier.cart.items.map((function(t){return window.mamutaMapItem(t)})),window.mamutaTier.cart.original_total_price+=t.line_price,window.mamutaTier.cart.total_price+=t.line_price,window.mamutaTier.cart.total_discount+=t.total_discount,window.mamutaTier.cart.total_weight+=t.grams,window.mamutaTier.cart.item_count+=t.quantity,window.mamutaTier.cart.items_subtotal_price+=t.line_price,window.mamutaTier.discounts=[],window.mamutaItems_lookup={cart_total:{key:"cart_total",id:"cart_total",title:"Subtotal",quantity:t.quantity,price:d(null,window.mamutaTier.cart.total_price/100,null),amount:d(null,window.mamutaTier.cart.total_price/100,null),amount_money:d(window.mamutaTier.money_format,window.mamutaTier.cart.total_price/100,null)}},window.mamutaItems_lookup[t.key]={key:t.key,id:t.id,product_title:a,variant_title:u,title:c,only_default_variant:t.product_has_only_default_variant,quantity:t.quantity,price:n,amount:r,amount_money:o};var l=sessionStorage.getItem("checkout_selector");l&&l.length>0&&(h(window.mamutaCartFormSelectors),h(window.mamutaAnnounces),ct(window.mamutaTier.proxy_prefix+"/cart/"+window.mamutaTier.shop_domain,window.mamutaCartFormSelectors,window.mamutaAnnounces))};function At(t,e,n){r("interceptCurrencyAPIResponse"),window.mamutaFetchMock.apply(this,t).then((function(t){if("opaque"===t.type)return o("Currency API: FETCH OPAQUE"),void r();o("Currency API: FETCH RESPONSE"),e(t);t.url;t.ok})).catch((function(t){return n(t)})),r()}function Pt(){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];r("FETCH"),o("args",e);var u=void 0===e||0===e.length?"":e[0],c=xt(u),s=It(u),l=!1,d=""!==u&&(c||s||l);if(!d)return o("API not in service",u),r(),new Promise((function(t,n){Ct(e,t,n,void 0,void 0)}));if(l)return r(),new Promise((function(t,n){At(e,t,n)}));if(s)return r(),new Promise((function(t,n){Et(e,t,n)}));var m,p=e[1]?e[1].headers:void 0,f=e[1]?JSON.parse(e[1].body):void 0;if(o("walletsBody",f),c&&f){var h="",w="";if(f.customer=window.mamutaTier.customer,f.checkout.cart_token?(C(),w=JSON.stringify(window.mamutaTier),h=window.mamutaTier.proxy_prefix+"/expresscart/"+window.mamutaTier.shop_domain):f.checkout.line_items&&(f.product_collections=window.mamutaTier.product_collections,f.product_price_lookup=window.mamutaTier.product_price_lookup,w=JSON.stringify(f),h=window.mamutaTier.proxy_prefix+"/express/"+window.mamutaTier.shop_domain),""===h)return a("Unknown page"),r(),new Promise((function(t,n){Ct(e,t,n,void 0,void 0)}));m=mamutaFetchMock(h,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include",body:w}).then((function(t){return i("Backend response",t),r(),t.json()})).catch((function(t){return a("Backend error",t)}))}return r(),new Promise((function(t,n){setTimeout((function(){Ct(e,t,n,p,m)}),3e3)}))}}function Lt(t){!function(t,e){Dt.push({selector:t,cb:e}),Rt||(Rt=new MutationObserver(Nt)).observe(document.documentElement,{childList:!0,subtree:!0});Nt(null,Rt)}(t,Mt)}function Mt(t,e){if(r("onCheckoutElementCreated"),0===t.offsetHeight||"none"===window.getComputedStyle(t).getPropertyValue("display"))return o("Hidden checkout element",t),void r();i("Visible checkout element",t),t.ready=!0,Yt(t),i("Checkout ready fetchData"),sessionStorage.setItem("checkout_selector",e),ct(window.mamutaTier.proxy_prefix+"/cart/"+window.mamutaTier.shop_domain,window.mamutaCartFormSelectors),r()}var Nt=function(t,e){return te(t,e,Dt)},Dt=[],Rt=null;function qt(t){Xt||(Xt=new MutationObserver(Ht)).observe(document.documentElement,{attributes:!0,characterData:!1,childList:!1,subtree:!0,attributeOldValue:!0,characterDataOldValue:!1}),Jt||(Jt=new IntersectionObserver((function(t,e){for(var n=0;n<t.length;++n)Ut(t[n].isIntersecting,t[n].target)}),{root:null})),jt(t,Ft)}var jt=function(t,e){r("miniCartSetObserver");var n={selector:t,cb:e};Gt.push(n);for(var o=document.querySelectorAll(t),a=0;a<o.length;++a)i("Will check",o[a]),Jt.observe(o[a]);r()};function Ft(t,e){if(r("onMiniCartCreated"),!t)return o("null element for:",e),void r();if(Kt){if(Kt.has(e))return o("already observing",e),void r()}else Kt=new Set;Kt.add(e),i("added for observation",t),Jt.observe(t),r()}var Ht=function(t,e){return te(t,e,Gt)},Ut=function(t,e){o("processElement: visible, element",t,e),t?Bt(e):Vt(e)},Bt=function(t){if(r("processVisibleElement"),t.mamutaOpened)return o("Already open",t),void r();if(window.mamutaCartDiscountsAPI)return o("API busy",t),void r();t.mamutaOpened=!0,o("Cart opened",t);for(var e=0;e<window.mamutaMiniCartCheckouts.length;++e){var n=t.querySelector(window.mamutaMiniCartCheckouts[e]);if(n&&!n.mamutaOnClick)"window.location='/checkout'"===n.getAttribute("onclick")&&n.removeAttribute("onclick"),Yt(n)}ct(window.mamutaTier.proxy_prefix+"/cart/"+window.mamutaTier.shop_domain,window.mamutaMiniCarts),r()},Vt=function(t){i("processInVisibleElement"),t.mamutaOpened&&(t.mamutaOpened=!1,i("Cart closed",t),h(window.mamutaMiniCarts))},Gt=[],Xt=null,Jt=null,Kt=null;function Wt(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function Yt(t){t&&u(t.addEventListener)&&(t.removeEventListener("click",zt,!1),t.addEventListener("click",zt,!1),t.mamutaOnClick=!0)}function zt(t){if(t.preventDefault(),r("checkoutClickHandler"),window.agreeTermsId&&window.agreeTermsId.length>0){var e=document.getElementById(window.agreeTermsId);return e&&"checkbox"===e.type.toLowerCase()&&!e.checked?void e.addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault(),$t(t)}),!1):void $t(t)}$t(t),r()}function $t(t){var e=t.target||t.srcElement,n=window.location.pathname.replace("cart","checkout");if(window.mamutaGridOnly||!Zt())return i("empty discounts"),void Qt(e,n);C();var r=e?e.form:null;o("cart form",r),function(){var t,u=(t=f.a.mark((function t(){var u,c;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,vt(window.mamutaTier.proxy_prefix+"/checkout/"+window.mamutaTier.shop_domain);case 3:if((u=t.sent)&&u.data){t.next=7;break}return o("null data"),t.abrupt("return",!1);case 7:if(!(u.data.invoice_url&&u.data.invoice_url.length>0)){t.next=11;break}return i("redirect to draft order"),window.location.href=u.data.invoice_url,t.abrupt("return",!0);case 11:if(u.data.discount_code&&0!==u.data.discount_code.length){t.next=14;break}return o("empty discount code"),t.abrupt("return",!1);case 14:n.includes("checkout")||(n="/checkout"),r?(o("adding field"),(c=r.querySelector("input[name='discount']"))||((c=document.createElement("input")).setAttribute("type","hidden"),c.setAttribute("name","discount"),r.appendChild(c)),c.value=u.data.discount_code):(o("prepare redirect path"),n+="?discount="+u.data.discount_code,e=null),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),a("Fetch discount code fault",t.t0);case 21:return Qt(e,n),t.abrupt("return",!0);case 23:case"end":return t.stop()}}),t,null,[[0,18]])})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Wt(i,r,o,a,u,"next",t)}function u(t){Wt(i,r,o,a,u,"throw",t)}a(void 0)}))});return function(){return u.apply(this,arguments)}}()().then((function(t){t||Qt(e,n)})),o("wait for completion"),function(t){var e=new Date,n=null;do{n=new Date}while(n-e<t)}(window.mamutaAcc)}function Qt(t,e){if(!t)return o("defaultClick redirect"),void(window.location.href=e);o("defaultClick emulate click"),t.removeEventListener("click",zt,!1),t.dispatchEvent(new MouseEvent("click",{bubbles:!0,view:window,cancelable:!0}))}var Zt=function(){if(!window.mamutaTier.discounts)return!1;var t=window.mamutaTier.discounts.filter((function(t){return"cart_total"===t.key}))[0];return t&&t.success_note&&t.success_note.length>0},te=function(t,e,n){for(var r=0;r<n.length;r++)ee(n[r].selector,n[r].cb)},ee=function(t,e){for(var n=document.querySelectorAll(t),r=0;r<n.length;r++){var o=n[r];o.ready||u(e)&&e.call(o,o,t)}};function ne(t,e){ie(),sessionStorage.setItem("checkout_selector","");var n=sessionStorage.getItem("clickme");if(n&&n.length>0){var a=e.querySelector(n);a&&setTimeout((function(){sessionStorage.setItem("clickme",""),a.click()}),500)}!function(){var t=I();if(!(t<=0)){for(var e in mamutaItems_lookup)if(mamutaItems_lookup.hasOwnProperty(e)){var n=mamutaItems_lookup[e];n.amount=E(null,n.amount*t),n.price=E(null,n.price*t),n.amount_money=E(mamutaTier.money_format,n.amount)}for(var r in mamutaTier.cart.product_lookup)if(mamutaTier.cart.product_lookup.hasOwnProperty(r)){var o=mamutaTier.cart.product_lookup[r];o.amount=E(null,o.amount*t),o.price=E(null,o.price*t)}for(var i in mamutaTier.cart.variant_lookup)if(mamutaTier.cart.variant_lookup.hasOwnProperty(i)){var a=mamutaTier.cart.variant_lookup[i];a.amount=E(null,a.amount*t),a.price=E(null,a.price*t)}mamutaTier.cart.original_total_price=mamutaTier.cart.original_total_price*t,mamutaTier.cart.total_price=mamutaTier.cart.total_price*t,mamutaTier.cart.items_subtotal_price=mamutaTier.cart.items_subtotal_price*t}}();var u=sessionStorage.getItem("current_currency");u&&u.length>0&&(t.mamutaTier.current_currency=u),oe(null!==t.location.search?t.location.search:null),e.addEventListener("visibilitychange",(function(n){o("Visibility change",e.visibilityState),oe(null!==t.location.search?t.location.search:null)}),!1),L(XMLHttpRequest.prototype.open),t.mamutaFetchMock=t.fetch,t.fetch=Pt();for(var c=0;c<mamutaCheckoutButtons.length;++c)Lt(mamutaCheckoutButtons[c]);var s=sessionStorage.getItem("checkout_selector");o("check if cart",t.mamutaTier.cart.item_count),o("check if discounts",t.mamutaTier.discounts.length),o("current data",t.mamutaTier),(!s||0===s.length)&&0===t.mamutaTier.discounts.length&&t.mamutaTier.cart&&t.mamutaTier.cart.item_count>0&&(i("dispatcher fetchCartDiscounts"),ct(t.mamutaTier.proxy_prefix+"/cart/"+t.mamutaTier.shop_domain,null,t.mamutaAnnounces)),t.mamutaTier.discounts.length>=0&&U(t.mamutaItems_lookup,t.mamutaTier.discounts,t.mamutaAnnounces);for(var l=0;l<t.mamutaMiniCarts.length;++l)qt(t.mamutaMiniCarts[l]);"cart"!==t.mamutaTier.current_page&&(i("fetch discounts for page",t.mamutaTier.current_page),pt(t.mamutaTier.backend_entry)),r()}var re=function(t){return function(e){if(!e.didTimeout&&e.timeRemaining()<5)oe(t);else{var n=null!==window.location.search?window.location.search:null;if(null!==n&&t!==n){var r=n.split("=")[1]||"";if(0===r.length)return o("variant empty"),void oe(n);window.mamutaTier.product.selected_variant=r,window.mamutaTier.product_price_lookup.hasOwnProperty(r)&&(window.mamutaTier.product.price=window.mamutaTier.product_price_lookup[r]),o("Fetch data for new variant",r),pt(window.mamutaTier.backend_entry)}oe(n)}}},oe=function(t){"hidden"!==document.visibilityState&&"product"===window.mamutaTier.current_page&&requestIdleCallback(re(t),{timeout:1e3})},ie=function(){var t=function(t){try{return new MouseEvent("test"),!1}catch(t){}var e=function(e,n){n=n||{bubbles:!1,cancelable:!1};var r=document.createEvent("MouseEvent");return r.initMouseEvent(e,n.bubbles,n.cancelable,t,0,n.screenX||0,n.screenY||0,n.clientX||0,n.clientY||0,n.ctrlKey||!1,n.altKey||!1,n.shiftKey||!1,n.metaKey||!1,n.button||0,n.relatedTarget||null),r};return e.prototype=Event.prototype,e}(window);t&&(window.MouseEvent=t),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(t){if(null===this)throw new TypeError('"this" is null or not defined');var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<n;){var i=e[o];if(t.call(r,i,o,e))return o;o++}return-1},configurable:!0,writable:!0}),window.requestIdleCallback||(o("Need requestIdleCallback polyfill"),window.requestIdleCallback=function(t){var e=Date.now();return setTimeout((function(){t({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})}),1)},window.cancelIdleCallback=window.cancelIdleCallback||function(t){clearTimeout(t)})};n("Wr5T"),"loading"===document.readyState?(o("document loading...",document.readyState),document.addEventListener("DOMContentLoaded",(function(t){o("document loaded",document.readyState),setTimeout((function(){ne(window,document)}),200)}),!1)):(o("document ready",document.readyState),setTimeout((function(){ne(window,document)}),200)),window.addEventListener("unload",(function(t){var e=function(){var t=gt(104,116,116,112,115,58,47,47),e=gt(97,112,112,48,46),n=gt(109,97,109,117,116,97,46),r=gt(99,111,109,47),o=gt(109,97,116,111,109,111,46,112,104,112),i="".concat(t).concat(e).concat(n).concat(r),a=new URL("".concat(i).concat(o),i),u=new FormData;u.set(gt(105,100,115,105,116,101),"2"),u.set(gt(114,101,99),"1");var c=new Date,s=c.getTime();u.set(gt(114,97,110,100),"".concat(s));var l=c.getHours();return u.set(gt(104),"".concat(l)),l=c.getMinutes(),u.set(gt(109),"".concat(l)),l=c.getSeconds(),u.set(gt(115),"".concat(l)),{u1:a,pms:u}}(),n=navigator.sendBeacon(e.u1.toString(),e.pms);o("document unload",n,e,t,window.location)}),!1)},ls82:function(t,e,n){var r=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new T(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var u=g(a,n);if(u){if(u===s)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=c(t,e,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===s)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),i}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var s={};function l(){}function d(){}function m(){}var p={};p[o]=function(){return this};var f=Object.getPrototypeOf,h=f&&f(f(k([])));h&&h!==e&&n.call(h,o)&&(p=h);var w=m.prototype=l.prototype=Object.create(p);function v(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function y(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=c(t[o],t,i);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(d).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function g(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,g(t,e),"throw"===e.method))return s;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,s;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function b(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return d.prototype=w.constructor=m,m.constructor=d,m[a]=d.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},v(y.prototype),y.prototype[i]=function(){return this},t.AsyncIterator=y,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new y(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(w),w[a]="Generator",w[o]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),b(n),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;b(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:k(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),s}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},o0o1:function(t,e,n){t.exports=n("ls82")}});</script>
